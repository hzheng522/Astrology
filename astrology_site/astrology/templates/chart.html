{% extends "astrology/base.html" %}

{% block title %}Chart | Astrology{% endblock %}

{% block content %}
<style>
  .chart-container {
    display: flex;
    gap: 30px;
    margin-top: 40px;
    align-items: flex-start;
    justify-content: center;
    font-family: 'Cormorant Garamond', serif;
  }

  .form-box {
    flex: 1;
    background-color: #1e1e2f;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    color: #fff;
  }

  .form-box h2 {
    margin-bottom: 20px;
    font-size: 24px;
    color: #ffcc70;
  }

  .form-group {
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    margin-bottom: 6px;
    font-size: 14px;
    color: #dcdcdc;
  }

  .form-group input {
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #444;
    background-color: #2d2d44;
    color: #fff;
    transition: border 0.3s;
  }

  .form-group input:focus {
    outline: none;
    border-color: #ffcc70;
  }

  .form-box button {
    padding: 12px 20px;
    background: #ffcc70;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    color: #333;
    transition: background 0.3s ease;
  }

  .form-box button:hover {
    background: #ffdd88;
  }

  #output {
    flex: 1;
    background-color: #0e0e1a;
    padding: 30px;
    border-radius: 16px;
    min-height: 400px;
    color: white;
    text-align: center;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
  }

  #output img {
    max-width: 100%;
    border-radius: 16px;
    box-shadow: 0 0 10px rgba(255, 204, 112, 0.2);
  }
</style>

<div class="chart-container">
  <div class="form-box">
    <h2>ðŸŒŸ Generate Your Birth Chart</h2>
    <form id="birthChartForm">
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" id="name" />
      </div>
      <div class="form-group">
        <label for="birthDate">Birth Date</label>
        <input type="date" id="birthDate" />
      </div>
      <div class="form-group">
        <label for="birthTime">Birth Time</label>
        <input type="time" id="birthTime" />
      </div>
      <div class="form-group">
        <label for="latitude">Latitude</label>
        <input type="number" id="latitude" step="any" />
      </div>
      <div class="form-group">
        <label for="longitude">Longitude</label>
        <input type="number" id="longitude" step="any" />
      </div>
      <div class="form-group">
        <label for="timezone">Time Zone</label>
        <input type="number" id="timezone" step="any" />
      </div>
      <button type="submit">ðŸ”® Generate</button>
    </form>
  </div>

  <div id="output">
    <p>Your chart will appear here âœ¨</p>
  </div>
</div>

<script>
document.getElementById('birthChartForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const [year, month, day] = document.getElementById('birthDate').value.split('-');
  const [hour, min] = document.getElementById('birthTime').value.split(':');

  const data = {
    day: parseInt(day),
    month: parseInt(month),
    year: parseInt(year),
    hour: parseInt(hour),
    min: parseInt(min),
    lat: parseFloat(document.getElementById('latitude').value),
    lon: parseFloat(document.getElementById('longitude').value),
    tzone: parseFloat(document.getElementById('timezone').value),
  };

  const userId = '639878';  
  const apiKey = '96f03ec92d46776d0476ac84cfe7fe29fb638089';
  const language = 'en';
  const api = 'natal_wheel_chart';

  const auth = "Basic " + btoa(userId + ":" + apiKey);

  const output = document.getElementById('output');
  output.innerHTML = '<p>âœ¨ Generating chart...</p>';

  fetch(`https://json.astrologyapi.com/v1/${api}`, {
    method: 'POST',
    headers: {
      'Authorization': auth,
      'Content-Type': 'application/json',
      'Accept-Language': language
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(json => {
    output.innerHTML = '';

    if (json.chart_url) {
      const img = document.createElement('img');
      img.src = json.chart_url;
      img.alt = 'Birth Chart';
      output.appendChild(img);
    } else {
      output.textContent = 'No chart URL found in the response.';
    }
  })
  .catch(err => {
    console.error(err);
    output.textContent = 'Something went wrong!';
  });
});
</script>

{% endblock %}
